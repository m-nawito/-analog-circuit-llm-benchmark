Awesome—let’s build a clean, bias-stable **common-source (CS) amplifier** in GF180 nm that meets your gain target at 1 kHz with only 100 µA of bias current and drives a 10 kΩ ∥ 1 pF load.

---

# Design approach & topology

**Topology.** NMOS **common-source stage** with a resistor load $R_D$ and **self-contained gate bias** generated by a **diode-connected NMOS + resistor** (no VDD-proportional divider, so the bias is much less sensitive to ±5% VDD). The output drives the specified $R_L = 10\text{k}\Omega$ and $C_L=1\text{ pF}$ **through an AC-coupling capacitor**, so the external load shapes AC gain without disturbing the DC operating point. Models are the 3.3 V **typical** BSIM4 devices from the supplied file.&#x20;

**Why AC-couple the load?** With a 10 kΩ DC load, a 100 µA stage would be forced to bias **very near ground** (DC current through $R_L$), killing headroom and gain. AC coupling lets DC bias be set by $R_D$ and the device, while the load still appears at AC (at 1 kHz the coupling reactance is $\approx159\ \Omega$ for 1 µF—negligible vs 10 kΩ).

---

# Hand design (back-of-the-envelope)

We target $|A_v|\ge 10$ (≥20 dB) at 1 kHz.

Small-signal gain (midband, single pole well above 1 kHz):

$$
A_v \approx -g_m\,(R_D \parallel R_L \parallel r_o)\ \approx\ -g_m\,(R_D \parallel R_L)
$$

since $r_o$ at 100 µA is typically much larger than 10–20 kΩ.

To get comfortable margin with a real $R_D$ (so that $R_D\parallel R_L$ isn’t limited too hard by $R_D$), we:

* choose $R_D = 20\text{k}\Omega\Rightarrow V_{OUT,DC}\approx V_{DD}-I_D R_D=3.3-0.1\cdot20=1.3\text{ V}$
* then $R_D\parallel R_L \approx (20k\parallel 10k)=6.67\text{k}\Omega$

Thus we need roughly:

$$
|A_v| \approx g_m\cdot 6.67\text{k}\Omega \ \ge 10 \Rightarrow g_m \gtrsim 1.5\text{ mS}
$$

At $I_D=100\ \mu\text{A}$, this implies an **overdrive** $V_{ov}=V_{GS}-V_{TH}\approx \frac{2I_D}{g_m}\approx \frac{200\ \mu\text{A}}{1.5\ \text{mS}}\approx 0.13\text{ V}$.
That’s **moderate inversion**, very reasonable for 180 nm.

**Bias generator.** Use a **diode-connected NMOS** $M_{REF}$ fed from VDD through $R_B$. Its gate node is our **bias voltage $V_{G}$**. The amplifier NMOS $M_1$ shares $V_G$, so its current scales with device width:

$$
I_{D1} \approx \left(\frac{W_1/L}{W_{REF}/L}\right)\,I_{REF} \equiv K\cdot I_{REF}
$$

Pick $I_{REF}\approx 20\ \mu\text{A}$ and $K\approx 5\Rightarrow I_{D1}\approx 100\ \mu\text{A}$.
Set $V_{ov}\approx 0.11\text{–}0.13\text{ V}$ by making $(W_{REF}/L)$ big enough for that overdrive at $I_{REF}$, then scale $W_1$ by $K$.

Using the NMOS model’s nominal mobility/oxide data (from the file) for a first-cut estimate:

$$
I \simeq \tfrac{1}{2}\mu_nC_{ox}\frac{W}{L}V_{ov}^2,\quad g_m \simeq \frac{2I}{V_{ov}}
$$

With $L=0.5\ \mu\text{m}$, a convenient set that lands us close:

* $W_{REF}\approx 15.6\ \mu\text{m}$, $I_{REF}\approx 20\ \mu\text{A}\Rightarrow V_{ov}\approx 0.11\text{ V}$
* $W_1 = 5\cdot W_{REF}\approx 78\ \mu\text{m}\Rightarrow I_D\approx 100\ \mu\text{A},\ g_m\approx 1.8\ \text{mS}$
* $R_D=20\text{k}\Omega\Rightarrow |A_v|\approx g_m\,(R_D\parallel R_L)\approx 1.8\text{mS}\cdot 6.67\text{k}\Omega\approx 12\text{ V/V}\ (\approx 21.6\text{ dB})$

**Bandwidth check (1 kHz target).** The load pole is

$$
f_p \approx \frac{1}{2\pi(R_D\parallel R_L)C_L} \approx \frac{1}{2\pi(6.67\text{k})\cdot 1\text{ pF}}\approx 24\ \text{MHz} \gg 1\ \text{kHz}.
$$

Coupling caps are sized so their high-pass corners are $\ll 1\ \text{kHz}$.

---

# Testbench & verification plan

* **DC (.op):** verify $I_D$ of $M1$ is $100\ \mu\text{A}\pm 20\%$; check $V_{OUT,DC}$ leaves $M_1$ in saturation.
* **Corners required by spec:**

  * **Supply tolerance**: step $V_{DD}\in\{3.135,\ 3.3,\ 3.465\}$ V (±5%).
  * **Bias spread**: step a width-scaling parameter $K_{SCALE}\in\{0.8,1.0,1.2\}$ to emulate $I_D$ ±20% and confirm $|A_v(1\text{kHz})|\ge 20\text{ dB}$.
* **AC (.ac):** use AC=1 mV source, measure gain at **1 kHz** as $20\log_{10}\left|V_{out\_load}/V_{in}\right|$.

---

# Complete NGSPICE netlist (runnable)

> Put the provided model file in the same folder as this netlist (or update the path on the `.include` line).

```
* GF180nm Common-Source Amplifier @ VDD=3.3V, ID~100uA, Av>=20 dB @1kHz
* Typical 3.3V NMOS/PMOS models (BSIM4) - include file provided by user
.include "GF180nm_sm141064_simplified.txt"

******* Parameters ***********************************************************
.param  VDD=3.3
.param  L1=0.5u
* Bias target: Iref ~20uA -> Vov ~0.11 V -> Wref ~15.6u for L=0.5u (first cut)
.param  Wref=15.6u
* Main device current scaling K ~ 5 => ID1 ~100uA
.param  Kscale=1.0           ; stepped 0.8/1.0/1.2 to emulate ID ±20%
.param  W1 = {Kscale*5*Wref} ; ~78u at Kscale=1
.param  RD=20k
.param  RB=124k              ; sets Iref approx 20uA with VGS ~0.81V at 3.3V
.param  RG=10meg
.param  Cin=1u
.param  Cout=1u
.param  RL=10k
.param  CL=1p
.param  RSIG=50

******* Supplies *************************************************************
VDD vdd 0 {VDD}

******* Bias generator (diode-connected NMOS) *******************************
* Diode NMOS defines Vbias ~= Vth + Vov; current set by RB from VDD.
MREF vbias vbias 0 0 nmos_3p3 W={Wref} L={L1}
RB1  vdd   vbias  {RB}

******* Amplifier core *******************************************************
* Common-source NMOS with resistive load RD to VDD
M1   out   gate  0 0 nmos_3p3 W={W1}  L={L1}
RD1  vdd   out   {RD}

* Gate DC tie to bias, AC input via coupling cap
RG1  gate  vbias {RG}

******* Input source and coupling ********************************************
VIN  in    0     AC 1m
RSRC in    0     {RSIG}
CIN1 in    gate  {Cin}

******* Output coupling to the specified load ********************************
COUT1 out  load  {Cout}
RLOAD load 0     {RL}
CLOAD load 0     {CL}

******* Analyses *************************************************************
.temp 27

* DC operating point
.op

* AC: wide sweep, but we'll measure at 1 kHz
.ac dec 100 10 100Meg

******* Measurements *********************************************************
* Drain current of M1 (positive for current into the drain)
.meas op  ID_M1  param='@M1[id]'
.meas op  VOUTDC param='v(out)'

* Midband gain at 1 kHz, from input source node "in" to the load node "load"
* Av_dB = Vout_dB - Vin_dB at 1 kHz
.meas ac AV_dB  find (vdb(load) - vdb(in)) at=1k
.meas ac AV_mag param='mag(v(load)/v(in))' at=1k

* Helpful: percent deviation of ID from 100uA at OP
.meas op ID_pct  param='100*(@M1[id]/100u - 1)'

******* Sweeps for spec verification *****************************************
* Supply tolerance ±5%
.step param VDD list 3.135 3.3 3.465

* Bias spread (emulate ID = 80uA, 100uA, 120uA via W scaling)
.step param Kscale list 0.8 1.0 1.2

.end
```

---

# What to expect when you run it

* **DC (.op)**: $I_D$ of **M1** close to 100 µA at VDD = 3.3 V and $K_{SCALE}=1$.
  $V_{OUT,DC}\approx 1.3\ \text{V}$ (keeps $M_1$ in saturation with comfortable margin).
* **AC (.ac)**: At **1 kHz**, the measured

  ```
  AV_dB  = vdb(load) - vdb(in)
  AV_mag = |V(load)/V(in)|
  ```

  should be **≥ 20 dB** across the stepped conditions (VDD ±5%, Kscale ±20%).
* **Bandwidth**: The dominant pole from (R\_D ∥ R\_L)–C\_L is in the tens of MHz, so 1 kHz sits deep in the flat gain region.

---

# Notes & verification checklist

* **Saturation check (M1)**: At OP, ensure $V_{DS}\ge V_{ov}$ (expect $V_{DS}\approx 1.3\text{ V}$, $V_{ov}\approx 0.11\text{–}0.13\text{ V}$).
* **Coupling caps**: With 1 µF, input HPF corner ≪1 kHz (≈ $1/(2\pi\,R_{in}\,C_{in})$, $R_{in}$ is $R_G\parallel$ gate leakage ≈ 10 MΩ ⇒ corner \~0.016 Hz). Output HPF corner with $R_L=10\text{k}\Omega, C_{out}=1\ \mu\text{F}$ is ≈15.9 Hz, well below 1 kHz.
* **Tuning knobs (if needed after first sim)**:

  * If $|A_v|$ is low: slightly **increase $W_1$** (or $W_{REF}$ and keep $K$), or **increase $R_D$** while ensuring $V_{OUT,DC}$ remains >\~0.3–0.4 V at all stepped corners.
  * If $I_D$ drifts too much across VDD steps: **increase $R_B$** a little (lower $I_{REF}$) and **increase $W_1/W_{REF}$** to hold $I_D\approx 100\ \mu\text{A}$. This moves operation a touch deeper into moderate inversion for higher $g_m/I$.

---

If you want, I can also produce a **netlist variant** that replaces $R_D$ with a **PMOS current source** for even higher intrinsic gain (then we keep the AC output coupling so the DC load doesn’t collapse the bias).
